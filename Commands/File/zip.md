# zip
## 1. 名称
`zip` - 打包和压缩文件集

## 2. 语法
`zip [-aABcdDeEfFghjklLmoqrRSTuvVwXyz!@$] [--longoption ...]  [-b path] [-n suffixes] [-t date] [-tt date] [zipfile [file ...]]  [-xi list]`  
   
`zipcloak` (详情见[zipcload](zipcloak.md))  
   
`zipnote` (详情见[zipnote](zipnote.md))  
   
`zipsplit` (详情见[zipsplit](zipsplit.md))  
   
## 3. 描述
`zip`是一个用于打包和压缩文件的工具. 支持所有常见的操作系统. 它和Unix的`[tar](tar.md), compress`命令有这类色的功能, 并且与`PKZIP`(MSDOS系统使用)兼容.  
  
`zip`与`[unzip](unzip.md)`是一个组合, 分别用于压缩和解压缩. 这两个命令也可以作用于使用`PKZIP`压缩成的文件上, 相同的`PKZIP`和`PKUNZIP`也可以对`zip`压缩的文件进行操作. 另外如果安装了`bzip2`相关的库的话, `zip`可以支持`bzip2`格式的压缩.  
  
可以在[示例](#示例)部分查看常见的zip使用方式.  
  
**关于大型文件和`Zip64`**. 对于将超过4GB的文件添加进压缩包时, 或者压缩包中存在使用`Zip64`打包的项目, 或者压缩包的大小超过了4GB时, 或者需要压缩的文件数量超过了64K, `zip`会自动使用`Zip64`扩展程序进行压缩. 另外对于通过标准输入流传输的文件进行压缩时, 也会自动使用`Zip64`. 因为无法提前的值标准输入流传输来的文件大小. 但是可以使用`-fz-`选项强制要求`zip`使用`PKZIP`对文件进行压缩.  
   
如果想要获得`zip`或者`unzip`的简要帮助说明, 可以直接通过在命令行上执行这两个命令并且不带任何的参数.

## 4. 使用
该命令在压缩文件集来节省磁盘空间时非常有用.  
  
`zip`命令也可以将一个或者多个压缩文件打包到一个`zip`文件中, 并保留着这些文件的相关信息(名称, 路径, 数据, 上次的修改时间, 安全信息和用于校验完整性的信息). 可以通过一个命令将一个完整的目录打包到`zip`文件中.  
  
### **命令的格式**. 
基本的命令格式为:  
  
&#8195;`zip 选项 zip文件名 需要打包的文件1 文件2 ...`  
  
其中`zip文件名`是一个新的或者已存在的zip文件, `需要打包的文件`可以是一个目录或者一个文件. 当`zip文件名`是一个已存在的zip文件, 并且`需要打包的文件`已存在于这个文件中(拥有相同的路径), `zip`将会替换原有的文件.   
  
例如`foo.zip`中已包含了文件`foo/file1`和`foo/file2`, 并且目录`foo`中包含文件`foo/file1`和`foo/file3`, 那么:  
  
&#8195;`zip -r foo.zip foo`  
  
或者更加简短的写法:  
  
&#8195;`zip -r foo foo`  
  
将会替换`foo.zip`中的`foo/file1`并且将`foo/file3`添加进`foo.zip`中. 在操作完成后, `foo.zip`中会包含`foo/file1`, `foo/file2`和`foo/file3`, 其中的`foo/file2`和之前的没有任何变化.  
  
所以在`zip`命令执行之前, `foo.zip`文件中包括:  
  
&#8195;`foo/file1  foo/file2`  
  
另外`foo`文件夹中有:  
  
&#8195;`file1  file3`  
  
在执行完`zip`操作后, `foo.zip`中:   
  
&#8195;`foo/file1  foo/file2  foo/file3`  
  
其中`foo/file1`是被替换的, `foo/file3`是新添加的.  
  
### **`-@ 文件集`.** 
如果一个文件集跟在**`-@ [MacOS上不适用]`**后面, `zip`将会通过标准输入流去获取这些文件而不是通过命令行. 例如:  
  
&#8195;`zip -@ foo`  
  
将会这些列在标准输入流中的文件保存到`foo.zip`中.  
  
在`Unix`系统下, 可以使用这个选项配合着[`find`](../find.md)命令实现非常强大的功能. 例如: 将当前目录和子路径下所有的`C`源代码打包可以通过:  
  
&#8195;`find . -name "*.[ch]" -print | zip source -@`  
  
(注意: 这里的正则表达式必须使用引号以确保shell可以正常的识别他们.)  
  
### **输入输出流.** 
`zip`可以接受一个`- (代表着标准输入输出)`作为`zip文件名称`, 在这种情况下`zip`将会把打包好的文件输出到标准输出流上去, 这样可以使用输出的文件通过管道被传送给其他的程序. 例如:  
  
&#8195;`zip -r - . | dd of=/dev/nrst0 obs=16k`  
  
将会把zip打包的文件通过管道直接备份到一个指定了固定区块大小的磁盘中去.  
  
`zip`也可以接受一个`- (代表着标准输入输出)`作为`需要打包的文件名称`, 这种情况下`zip`可以从标准输入流中获取需要打包的文件, 这些文件一般都是其他的程序通过管道输入给`zip`的. 例如:  
  
&#8195;`tar cf - . | zip backup -`  
  
将会压缩`tar`命令传输来的当前路径下的所有文件. 这种压缩方式一般情况下会好于上一个例子中通过`-r`选项的压缩方式. 因为这样`zip`可以利用文件之间的冗余达到更好的压缩效果. 可以使用下面的命令对上面压缩的文件进行解压:  
  
&#8195;`unzip -p backup | tar xf -`  
  
当没有指定`zip文件名称`并且标准输出没有终结时(后续还有程序可以处理`zip`的输出), `zip`将被用作一个过滤器, 对标准输入的数据进行压缩后返回给标准输出. 例如:  
  
&#8195;`tar cf - . | zip | dd of=/dev/nrst0 obs=16k`  
  
等同于  
  
&#8195;`tar cf - . | zip - - | dd of=/dev/nrst0 obs=16k`  
  
通过上面的方式压缩的zip文件可以使用`funzip (由unzip包提供)`进行解压, 或者使用`gunzip (由gzip包提供)`解压. (但是当`zip`使用`Zip64`格式压缩成的文件是无法通过`gunzip`进行解压的). 例如:  
  
&#8195;`dd if=/dev/nrst0 ibs=16k | funzip | tar xvf -`  
  
这个文件流(dd的of)也可以保存成一个文件, 然后通过`unzip`去解压.  
  
### **zip文件**
当要改变一个已存在的zip文件时, `zip`会重新创建一个新的临时文件将数据写入这个文件中, 只有当程序正确执行完成后才会使用新的临时文件替换原有的zip文件.  
  
如果zip文件的结尾没有包含扩展名, 则会自动为文件添加`.zip`扩展名. 如果文件已经包含一个非`.zip`的扩展名, 那么原扩展名将不会被修改. 但是对于切割过的zip文件要求最后一个部分的扩展名必须是`.zip`.  
  
### **扫描和读取文件**
当`zip`程序启动时会去扫描那些需要被打包的文件. 如果此次扫描的时长超过5秒, `zip`会展示"正在扫描文件"的提示信息, 并且每隔2秒或者扫描了指定数量的文件后会展示一个程序执行中的`.`符号. 如果在两个`.`出现之间的时间超过了2秒可能是因为查找每个文件比较耗时或者网络连接不稳定. **`-ds`** 无法控制扫描文件的`.`的速度, 但是可以使用**`-q`**禁止`.`的显示. **`-sf`**显示文件的选项可以被用来显示已经扫描完成的文件.  
  
如果`zip`无法读取一个文件, 将会提示一个警告信息并继续执行. 查看下面**`-MM`**选项的介绍来了解更多关于`zip`如何处理那些没有匹配到的正则表达式和无法读取的文件. 如果有文件被跳过了, `zip`会在执行完成后显示一条警告消息标注多少文件被读取, 多少文件被跳过.  
  
### **命令模式**
`zip`目前已支持两种类型的命令模式: **内部模式**和**外部模式**. 其中**外部模式**(增加, 更新和刷新)可以从文件系统中读取文件, 而**内部模式**(删除和复制)只会对zip文件内部进行操作.  
  
* **add**
  - 更新已存在的文件和添加新的文件. 如果zip文件不存在会自动创建, 这是默认的模式.
* **update** (**-u**)
  - 更新已存在的文件和添加新的文件. 如果zip文件不存在则提示警告消息并创建文件.
* **freshen** (**-f**)
  - 如果文件系统中的文件更新, 则更新已存在的文件. 这个模式不会添加新的文件到zip文件中.
* **delete** (**-d**)
  - 获取zip文件中的文件并删除他们.
* **copy** (**-U**)
  - 获取一个zip文件中的文件并将他们复制到另一个新的zip文件中. 这个新的模式和**update**模式很相似, 但这个模式是从一个已存在的zip文件中获取文件而不是从文件系统中获取. 它使用**--out**选项将获取到的文件写入新的zip文件中并不会修改原来的zip文件.
  
新的文件同步选项**-FS**也可以被认为是一个新的模式, 和**update**类似. 这个模式对已存在于zip文件中的文件和文件系统中的文件进行比较, 如果文件时间和大小有不同的话, 会更新这个文件. 另外也可以新增不存在的文件, 删除已存在的文件.  
  
### **切分zip文件**


使用zip格式的文件压缩
格式:zip 选项 压缩包名 需要压缩的文集序列

#常用选项
-m		#压缩完成有删除源文件
-r		#需要压缩的是一个目录
-j		#忽略子目录内容
-n 文件		#选择不需要压缩的文件(忽略他们)
-y		#不要压缩链接文件的源文件
-数字		#设置压缩率(1-9,9为最高压缩率)

#注意
1.zip与gz的区别
zip在处理文本文件处理方面优越
gz在处理二进制文件处理方面优越
2.-n选项的后面如果有多种格式,将每种格式之间使用:分隔

#示例
#zip后面接压缩后的文件名，在它后面输入要压缩的文件
zip file.zip *			
zip file.zip aaa bbb ccc	#将多个文件压缩到同一包中
#将a.txt压缩为file.zip文件并在压缩完成后删除源文件
zip -m file.zip a.txt
zip -r file.zip *		#将当前目录下的子目录一起压缩
zip -j file.zip *		#忽略子目录的内容
zip -n .jpg: .gif:.mpg		#将以压缩的文件或者没必要压缩的文件去掉
zip -y file.zip *		#不要压缩链接文件的原文件
zip -3 file.zip *		#按照3的压缩率压缩指定文件


-------------------------------------------------------------------
#解压缩文件夹
格式:unzip 压缩包

#常用选项
-Z		#显示压缩包内容
-l		#同上
-v		#同上

#示例
unzip file.zip			#解压目标文件
unzip -Z file.zip
unzip -l file.zip
unzip -v file.zip
